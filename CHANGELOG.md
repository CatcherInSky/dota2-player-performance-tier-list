# ğŸ“‹ æ›´æ–°æ—¥å¿—

## âœ… 2024-01-30 - æ•°æ®è®°å½•åŠŸèƒ½å…¨é¢æ”¹è¿›

### é—®é¢˜ 1: âœ… æ·»åŠ æ‰€æœ‰ç©å®¶æ•°æ®ï¼ˆé˜Ÿå‹å’Œå¯¹æ‰‹ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `public/gamestate_integration_performance.cfg`

```diff
  "data"
  {
    "provider"        "1"
    "map"             "1"
    "player"          "1"
    "hero"            "1"
    "abilities"       "1"
    "items"           "1"
    "buildings"       "1"
+   "allplayers"      "1"    ğŸ‘ˆ æ–°å¢ï¼šè·å–æ‰€æœ‰10ä¸ªç©å®¶æ•°æ®
  }
```

**æ•ˆæœ**: ç°åœ¨å¯ä»¥è·å–é˜Ÿå‹å’Œå¯¹æ‰‹çš„å®Œæ•´æ•°æ®ï¼

---

### é—®é¢˜ 2: âœ… å‡å°‘æ•°æ®é‡ï¼ˆä»22MBé™åˆ°5-6MBï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `public/gamestate_integration_performance.cfg`

```diff
- "throttle"          "0.5"
+ "throttle"          "2.0"    ğŸ‘ˆ æ•°æ®å‘é€é—´éš”ï¼š0.5s â†’ 2s

- "heartbeat"         "10.0"
+ "heartbeat"         "30.0"   ğŸ‘ˆ å¿ƒè·³é—´éš”ï¼š10s â†’ 30s
```

**æ•ˆæœ**: 
- æ•°æ®é‡å‡å°‘ **75%**
- 40åˆ†é’Ÿå¯¹å±€ï¼š22MB â†’ 5-6MB
- ä»ä¿æŒè¶³å¤Ÿçš„æ•°æ®å¯†åº¦ç”¨äºåˆ†æ

---

### é—®é¢˜ 3: âœ… æ”¹ä¸ºæ ‡å‡†JSONæ ¼å¼

**ä¿®æ”¹æ–‡ä»¶**: `src/server.ts`

**æ—§æ ¼å¼** (JSONL - ä¸æ˜¯æœ‰æ•ˆJSON):
```
{"seq": 1, "data": {...}}
{"seq": 2, "data": {...}}
```

**æ–°æ ¼å¼** (æ ‡å‡†JSON):
```json
{
  "_meta": {
    "description": "Dota2 å¯¹å±€æ•°æ®è®°å½•",
    "match_id": "7654321",
    "total_entries": 120,
    "start_time": "2024-01-30T18:00:00.000Z",
    "end_time": "2024-01-30T18:45:00.000Z",
    "duration_seconds": 2700
  },
  "entries": [
    {"seq": 1, "timestamp": "...", "data": {...}},
    {"seq": 2, "timestamp": "...", "data": {...}}
  ]
}
```

**æ•ˆæœ**: å¯ä»¥ç›´æ¥ç”¨ `JSON.parse()` è¯»å–ï¼ŒåŒ…å«å®Œæ•´å…ƒæ•°æ®ï¼

---

### é—®é¢˜ 4: âœ… è‡ªåŠ¨æŒ‰å¯¹å±€åˆ†æ–‡ä»¶

**ä¿®æ”¹æ–‡ä»¶**: `src/server.ts`

**æ—§é€»è¾‘**:
- åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªæ–‡ä»¶
- æ‰€æœ‰å¯¹å±€æ•°æ®å†™å…¥åŒä¸€æ–‡ä»¶

**æ–°é€»è¾‘**:
- è‡ªåŠ¨æ£€æµ‹å¯¹å±€å¼€å§‹ï¼ˆé€šè¿‡ `matchid` å’Œæ¸¸æˆçŠ¶æ€ï¼‰
- è‡ªåŠ¨æ£€æµ‹å¯¹å±€ç»“æŸï¼ˆ`DOTA_GAMERULES_STATE_POST_GAME`ï¼‰
- æ¯ä¸ªå¯¹å±€ç‹¬ç«‹æ–‡ä»¶ï¼Œä»¥å¯¹å±€å¼€å§‹æ—¶é—´å‘½å

**æ–‡ä»¶ç»“æ„**:
```
gsi-logs/
â”œâ”€â”€ match-2024-01-30T18-00-15.json  ğŸ‘ˆ ç¬¬ä¸€åœºå¯¹å±€
â”œâ”€â”€ match-2024-01-30T19-30-22.json  ğŸ‘ˆ ç¬¬äºŒåœºå¯¹å±€
â””â”€â”€ match-2024-01-30T21-15-08.json  ğŸ‘ˆ ç¬¬ä¸‰åœºå¯¹å±€
```

**æ•ˆæœ**: 
- æ¯åœºå¯¹å±€æ•°æ®æ¸…æ™°åˆ†ç¦»
- æ–‡ä»¶åå³å¯¹å±€æ—¶é—´ï¼Œæ–¹ä¾¿æŸ¥æ‰¾
- å¯¹å±€ç»“æŸè‡ªåŠ¨ä¿å­˜

---

## ğŸš€ ä½¿ç”¨æ–°åŠŸèƒ½

### 1. é‡æ–°ç¼–è¯‘

```bash
cd /home/zhang/dota2-player-performance-tier-list
npm run build
```

### 2. å¯åŠ¨åº”ç”¨

```bash
npm start
```

### 3. **é‡è¦ï¼šé‡å¯Dota2**

é…ç½®æ–‡ä»¶å·²æ›´æ–°ï¼Œ**å¿…é¡»å®Œå…¨é‡å¯Dota2**æ‰èƒ½ç”Ÿæ•ˆï¼

### 4. è¿›å…¥å¯¹å±€

åº”ç”¨ä¼šè‡ªåŠ¨ï¼š
- æ£€æµ‹å¯¹å±€å¼€å§‹ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
- æ¯2ç§’è®°å½•ä¸€æ¬¡æ•°æ®
- å¯¹å±€ç»“æŸè‡ªåŠ¨ä¿å­˜

**æ§åˆ¶å°è¾“å‡º**:
```
ğŸ® æ£€æµ‹åˆ°æ–°å¯¹å±€å¼€å§‹ï¼
ğŸ“ å¯¹å±€æ–‡ä»¶: match-2024-01-30T18-00-15.json
ğŸ†” å¯¹å±€ID: 7654321

ğŸ’¾ å·²è®°å½• 10 æ¡æ•°æ®ï¼Œå½“å‰å¤§å°: 0.25 MB
ğŸ’¾ å·²è®°å½• 20 æ¡æ•°æ®ï¼Œå½“å‰å¤§å°: 0.48 MB
...

ğŸ å¯¹å±€ç»“æŸï¼Œæ­£åœ¨ä¿å­˜æ•°æ®...

ğŸ’¾ å¯¹å±€æ•°æ®å·²ä¿å­˜ï¼
ğŸ“„ æ–‡ä»¶: match-2024-01-30T18-00-15.json
ğŸ“Š è®°å½•æ•°: 120 æ¡
ğŸ“¦ æ–‡ä»¶å¤§å°: 5.8 MB
```

---

## ğŸ“Š æ–°æ•°æ®ç»“æ„ç¤ºä¾‹

### allplayers æ•°æ®

```json
{
  "allplayers": {
    "player0": {
      "accountid": 123456789,
      "name": "Player1",
      "team": 2,              // 2 = Radiant, 3 = Dire
      "kills": 5,
      "deaths": 2,
      "assists": 8,
      "last_hits": 45,
      "denies": 3,
      "gold": 1250,
      "level": 7,
      "hero_id": 1
    },
    "player1": { ... },  // é˜Ÿå‹/å¯¹æ‰‹ 1
    "player2": { ... },  // é˜Ÿå‹/å¯¹æ‰‹ 2
    ...
    "player9": { ... }   // é˜Ÿå‹/å¯¹æ‰‹ 9
  }
}
```

### åŒºåˆ†é˜Ÿå‹å’Œå¯¹æ‰‹

```javascript
// è¯»å–å¯¹å±€æ–‡ä»¶
const matchData = require('./gsi-logs/match-2024-01-30T18-00-15.json');

// è·å–æœ€åä¸€æ¡æ•°æ®ï¼ˆåŒ…å«å®Œæ•´ä¿¡æ¯ï¼‰
const lastEntry = matchData.entries[matchData.entries.length - 1];
const myTeam = lastEntry.data.player.team_name; // "radiant" æˆ– "dire"

// åˆ†ç±»æ‰€æœ‰ç©å®¶
const teammates = [];
const enemies = [];

Object.values(lastEntry.data.allplayers).forEach(player => {
  const isRadiant = player.team === 2;
  const isDire = player.team === 3;
  
  if ((myTeam === 'radiant' && isRadiant) || (myTeam === 'dire' && isDire)) {
    teammates.push(player);
  } else {
    enemies.push(player);
  }
});

console.log('é˜Ÿå‹:', teammates.map(p => p.name));
console.log('å¯¹æ‰‹:', enemies.map(p => p.name));
```

---

## ğŸ›ï¸ æ–°APIç«¯ç‚¹

### GET /logs

æŸ¥çœ‹æ‰€æœ‰å¯¹å±€æ–‡ä»¶ï¼š

```bash
curl http://localhost:32866/logs | jq
```

### POST /logs/save

æ‰‹åŠ¨ä¿å­˜å½“å‰å¯¹å±€ï¼ˆä¸ç­‰å¾…å¯¹å±€ç»“æŸï¼‰ï¼š

```bash
curl -X POST http://localhost:32866/logs/save
```

ç”¨é€”ï¼šé•¿æ—¶é—´å¯¹å±€æƒ³ä¸­é€”ä¿å­˜ï¼Œæˆ–æµ‹è¯•åŠŸèƒ½ã€‚

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | æ—§é…ç½® | æ–°é…ç½® | æ”¹è¿› |
|------|--------|--------|------|
| æ•°æ®å‘é€é—´éš” | 0.5ç§’ | 2ç§’ | 4å€ â†“ |
| 40åˆ†é’Ÿå¯¹å±€æ•°æ®é‡ | ~22 MB | ~5-6 MB | 75% â†“ |
| æ–‡ä»¶æ ¼å¼ | JSONL | æ ‡å‡†JSON | âœ… |
| å¯¹å±€æ–‡ä»¶ | æ··åˆåœ¨ä¸€èµ· | è‡ªåŠ¨åˆ†ç¦» | âœ… |
| ç©å®¶æ•°æ® | ä»…è‡ªå·± | æ‰€æœ‰10äºº | âœ… |

---

## ğŸ’¡ åç»­å¼€å‘å»ºè®®

æœ‰äº†è¿™äº›ä¼˜åŒ–ï¼Œä½ ç°åœ¨å¯ä»¥ï¼š

### 1. å›¢é˜Ÿè¡¨ç°åˆ†æ
```javascript
// è®¡ç®—å›¢é˜Ÿå¹³å‡KDA
const teamKDA = teammates.reduce((sum, p) => {
  return sum + (p.kills + p.assists) / Math.max(p.deaths, 1);
}, 0) / teammates.length;
```

### 2. å¯¹æ‰‹åˆ†æ
```javascript
// æ‰¾å‡ºå¯¹é¢carry
const enemyCarry = enemies.find(p => p.gold === Math.max(...enemies.map(e => e.gold)));
console.log(`å¯¹é¢æœ€è‚¥: ${enemyCarry.name}, é‡‘é’±: ${enemyCarry.gold}`);
```

### 3. ä½ç½®åˆ†æ
æ ¹æ® `hero_id` å’Œæ•°æ®ç‰¹å¾åˆ¤æ–­ä½ç½®ï¼ˆ1-5å·ä½ï¼‰

### 4. æ—¶é—´çº¿åˆ†æ
```javascript
// åˆ†æç»æµæ›²çº¿
const goldTimeline = matchData.entries.map(e => ({
  time: e.data.map.game_time,
  myGold: e.data.player.gold,
  enemyCarryGold: e.data.allplayers.player5?.gold || 0
}));
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»é‡å¯Dota2** - é…ç½®æ–‡ä»¶ä¿®æ”¹åéœ€è¦å®Œå…¨é‡å¯æ¸¸æˆ
2. **æ•°æ®å®æ—¶æ€§** - throttleå¢åŠ åˆ°2ç§’ï¼Œå®æ—¶æ€§ç•¥é™ä½†ä»è¶³å¤Ÿåˆ†æ
3. **å†…å­˜ä½¿ç”¨** - å¯¹å±€æ•°æ®åœ¨å†…å­˜ä¸­ç¼“å­˜ï¼Œç»“æŸåå†™å…¥æ–‡ä»¶
4. **allplayersæ•°æ®** - åªåœ¨è¿›å…¥æ¸¸æˆåæ‰æœ‰ï¼Œé€‰äººé˜¶æ®µå¯èƒ½ä¸ºç©º

---

**ç°åœ¨é‡æ–°ç¼–è¯‘å¹¶å¼€å§‹æ–°çš„å¯¹å±€å§ï¼** ğŸ®ğŸ“Šâœ¨

```bash
npm run build && npm start
```

