# 功能清单 - 对照 PRD

基于 `prd.md` 的完整功能清单和开发进度跟踪。

---

## ✅ 已完成功能

### 1. 技术框架搭建 (PRD 2章节)

- ✅ **项目配置**
  - ✅ TypeScript + React 18
  - ✅ TailwindCSS + shadcn/ui（配置完成，组件待开发）
  - ✅ Vite 构建工具
  - ✅ IndexedDB (Dexie.js)
  - ✅ 所有依赖使用 MIT 协议

- ✅ **Overwolf 集成**
  - ✅ manifest.json 配置
  - ✅ 3个窗口配置（background, desktop, ingame）
  - ✅ 游戏目标配置（Dota 2, game_id: 7314）
  - ✅ 快捷键配置（Alt+`）
  - ✅ 权限配置

### 2. 数据库设计 (PRD 4章节)

- ✅ **数据表结构定义**
  - ✅ Match 表（比赛）
  - ✅ Player 表（玩家）
  - ✅ MatchPlayer 表（比赛玩家关联）
  - ✅ Review 表（点评）

- ✅ **数据库操作层**
  - ✅ db.ts - Dexie 实例和索引配置
  - ✅ players.ts - 玩家数据同步、查询统计
  - ✅ matches.ts - 比赛记录、查询
  - ✅ reviews.ts - 点评保存、查询

### 3. 游戏生命周期 (PRD 3章节)

- ✅ **GEP 事件监听框架**
  - ✅ 事件类型定义
  - ✅ GEPService 类实现
  - ✅ 事件回调注册机制

- ✅ **Background Window 逻辑**
  - ✅ 游戏状态监听
  - ✅ STRATEGY_TIME 处理（展示记录小窗）
  - ✅ TEAM_SHOWCASE 处理（展示点评小窗）
  - ✅ 比赛数据记录流程

### 4. 窗口架构 (PRD 5章节)

- ✅ **窗口类型定义**
  - ✅ Background Window（后台）
  - ✅ Desktop Window（桌面）
  - ✅ InGame Window（游戏内）

- ✅ **窗口管理服务**
  - ✅ WindowManager 类
  - ✅ 显示/隐藏窗口方法
  - ✅ 窗口模式切换

---

## ⏳ 进行中功能

### 5. Desktop Window - 桌面窗口 (PRD 6.2章节)

**状态**: 基础框架已创建，页面待开发

#### 6.2.2 主页 (HomePage)
- ⏳ **个人战绩统计卡片**
  - [ ] 总对局数
  - [ ] 胜率统计
  - [ ] 评分给出数量
  
- ⏳ **最近对局列表**
  - [ ] 显示最新10场比赛
  - [ ] 比赛时间、模式、结果
  - [ ] 点击查看详情

- ⏳ **常见队友/对手**
  - [ ] 按遇到次数排序
  - [ ] 显示平均评分
  - [ ] 点击查看详细历史

#### 6.2.3 数据页 (DataPage)
- ⏳ **3个Tab页**
  - [ ] 比赛 Tab
    - [ ] 表格显示（序号、时间、模式、结果、时长、击杀比分）
    - [ ] 筛选：游戏模式、结果、时间范围
    - [ ] 分页器
  - [ ] 玩家 Tab
    - [ ] 表格显示（Steam ID、昵称、曾用名、遇到次数、平均评分、最后遇到时间）
    - [ ] 筛选：昵称搜索、评分范围
    - [ ] 查看历史点评操作
  - [ ] 点评 Tab
    - [ ] 表格显示（比赛时间、被评价玩家、评分、评论）
    - [ ] 筛选：玩家搜索、评分范围、关键词
    - [ ] 编辑/删除操作

#### 6.2.4 设置页 (SettingsPage)
- ⏳ **基础设置**
  - [ ] 语言选择（中文/英文）
  - [ ] 快捷键设置（默认 Alt+`）

- ⏳ **评分文案**
  - [ ] 5星文案输入（默认"夯"）
  - [ ] 4星文案输入（默认"顶级"）
  - [ ] 3星文案输入（默认"普通人"）
  - [ ] 2星文案输入（默认"NPC"）
  - [ ] 1星文案输入（默认"拉"）
  - [ ] 恢复默认按钮

- ⏳ **数据管理**
  - [ ] 导出数据按钮（JSON格式）
  - [ ] 导入数据按钮
  - [ ] 删除所有数据按钮（带二次确认）

- ⏳ **关于信息**
  - [ ] 版本号显示
  - [ ] Overwolf 应用ID
  - [ ] 查看使用说明
  - [ ] 检查启动参数

### 6. InGame Window - 游戏内窗口 (PRD 6.3章节)

**状态**: 基础框架已创建，UI待开发

#### 6.3.2 记录小窗 (RecordMode)
- ⏳ **显示时机**: STRATEGY_TIME 阶段
- ⏳ **布局**
  - [ ] 天辉队伍区域（5个玩家卡片）
  - [ ] 夜魇队伍区域（5个玩家卡片）
  - [ ] 过滤掉本地玩家（自己）

- ⏳ **玩家卡片内容**
  - [ ] 英雄头像
  - [ ] 玩家昵称（含曾用名）
  - [ ] 历史平均评分（⭐ + 数字）
  - [ ] 评价次数（"8次" 或 "首次"）
  - [ ] 最后一次评论（最多10字符）
  - [ ] 颜色标识（1-2星红色，3星灰色，4-5星绿色）

- ⏳ **交互**
  - [ ] 只读显示
  - [ ] 可拖动窗口
  - [ ] Alt+` 隐藏窗口

#### 6.3.3 点评小窗 (ReviewMode)
- ⏳ **显示时机**: TEAM_SHOWCASE 阶段
- ⏳ **布局**
  - [ ] 9个玩家卡片（3x3网格）
  - [ ] 每个卡片独立评分

- ⏳ **玩家卡片内容**
  - [ ] 英雄头像
  - [ ] 玩家昵称
  - [ ] 队伍标识（天辉/夜魇，颜色区分）
  - [ ] 5星评分组件（点击选择）
  - [ ] 短评输入框（单行，50字符）

- ⏳ **按钮**
  - [ ] 跳过按钮（不保存，直接关闭）
  - [ ] 保存按钮（保存已评分玩家，关闭窗口）

- ⏳ **交互逻辑**
  - [ ] 可选择性评价（不强制全部评价）
  - [ ] 只保存点击了星星的玩家
  - [ ] 评论可选

---

## 📋 待开发功能

### 7. 核心功能逻辑 (PRD 7章节)

#### 7.1 启动参数检查
- [ ] 检测 `ProcessCommandLine` 是否包含 `-gamestateintegration`
- [ ] 引导界面设计
  - [ ] 步骤说明
  - [ ] 复制参数按钮
  - [ ] 打开Steam按钮
  - [ ] 我已完成按钮

#### 7.2 玩家数据同步
- ✅ 基础逻辑已实现（syncPlayers函数）
- [ ] 与UI集成
- [ ] 实时更新显示

#### 7.3 比赛记录
- ✅ 基础逻辑已实现（recordMatch函数）
- [ ] 与UI集成
- [ ] 胜负判断逻辑

#### 7.4 点评保存
- ✅ 基础逻辑已实现（saveReviews函数）
- [ ] 与UI集成
- [ ] 统计字段更新

#### 7.5 数据导出
- [ ] 导出为JSON格式
- [ ] 包含version、export_time、app_version
- [ ] 包含metadata统计信息
- [ ] 触发浏览器下载

#### 7.6 数据导入
- [ ] 读取JSON文件
- [ ] 版本检查
- [ ] 使用bulkPut导入（覆盖策略）
- [ ] 显示导入统计

### 8. 系统托盘 (PRD 6.1章节)

#### 托盘图标
- [ ] 显示图标
- [ ] 状态颜色
  - [ ] 灰色：Dota 2 未运行
  - [ ] 绿色：Dota 2 运行中
  - [ ] 红色：启动参数检查失败

#### 右键菜单
- [ ] 打开主窗口
- [ ] 打开数据页
- [ ] 打开设置页
- [ ] 检查启动参数
- [ ] 退出

### 9. 国际化 (PRD 设置页要求)

- [ ] 创建语言包
  - [ ] zh-CN.json（中文）
  - [ ] en-US.json（英文）
- [ ] 实现i18n切换
- [ ] 翻译所有界面文本
- [ ] 翻译错误提示

### 10. 共享组件库

#### 基础组件
- [ ] Button 组件
- [ ] Input 组件
- [ ] Select 组件
- [ ] Modal 组件
- [ ] Tooltip 组件
- [ ] Table 组件
- [ ] Pagination 组件
- [ ] RatingStars 组件（⭐评分）

#### Hooks
- [ ] useDatabase - 数据库操作
- [ ] useSettings - 设置管理
- [ ] useOverwolf - Overwolf API
- [ ] useI18n - 国际化

#### Utils
- [ ] format.ts - 时间、数字格式化
- [ ] i18n.ts - 国际化工具
- [ ] steam.ts - Steam ID转换

### 11. Overwolf API 真实集成

- [ ] 集成 @overwolf/overwolf-api-ts
- [ ] 替换 GEP 服务中的注释代码
- [ ] 替换窗口管理中的注释代码
- [ ] 实现快捷键注册
- [ ] 测试游戏内数据获取

---

## 🔍 技术债务

### 代码质量
- [ ] 恢复 `noUnusedLocals: true`
- [ ] 恢复 `noUnusedParameters: true`
- [ ] 清理未使用的导入
- [ ] 添加单元测试

### 性能优化
- [ ] 虚拟滚动（数据表格）
- [ ] 查询性能优化
- [ ] 数据缓存策略

### 用户体验
- [ ] 加载状态提示
- [ ] 错误处理和提示
- [ ] 窗口位置记忆
- [ ] 自动备份功能

---

## 📊 完成度统计

### 总体进度

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 项目配置 | 100% | ✅ |
| 数据库层 | 100% | ✅ |
| 类型定义 | 100% | ✅ |
| Background Window | 90% | ✅ |
| GEP 服务 | 80% | ⏳ |
| 窗口管理 | 80% | ⏳ |
| Desktop Window | 10% | ⏳ |
| InGame Window | 10% | ⏳ |
| 系统托盘 | 0% | 📋 |
| 数据导入导出 | 0% | 📋 |
| 国际化 | 0% | 📋 |
| Overwolf API 集成 | 0% | 📋 |

**整体完成度**: 约 **35%**

---

## 📅 开发建议

### 第一优先级（立即开始）
1. ✅ Desktop Window 基础UI（已完成框架）
2. Desktop Window 主页组件
3. Desktop Window 数据页组件
4. Desktop Window 设置页组件

### 第二优先级
1. InGame Window 记录模式
2. InGame Window 点评模式
3. 共享组件库

### 第三优先级
1. 数据导入导出功能
2. 系统托盘
3. 国际化

### 第四优先级
1. Overwolf API 真实集成
2. 在 Overwolf 环境中测试
3. 性能优化

---

最后更新：2025-11-02

